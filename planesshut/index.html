
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battery game</title>
    <style>
        
        #space{
            background-color: rgb(14, 13, 13);
            background: url(img/sky.jpg) 100% 100%;
            position: relative;
            width: 800px;
            height: 550px;
            margin:auto;
            cursor: none;
        }

    
         .plane{
            position: absolute;
            margin: auto;
            transform: rotate(0deg);
         }

         .plane2{
            filter: invert(100%);
            transform: rotate(180deg);
         }

         .missile{
            position: absolute;
            margin: auto;
         }

         .missile1{
            width:5px;
            height:5px;
            background-color: red;
            border-radius: 50%;
         }

         .missile2{
            width:20px;
            height:20px;
         }

         .infos{
            margin-top: 10px;
            color: white;
            text-align: center;
            font-size: 20px;
         }

         .infos div{
             display: inline-block;
             width:24%;
         }

         #messages{
            position: absolute;
            background-color: #ff000036;
            padding-top: 60px;
            color: white;
            text-align: center;
            font-size: 60px;
            width: 100%;
            height: 490px;
            top: 0;
         }

         .selectDisable {
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -o-user-select: none;
            user-select: none;
        }
         
    </style>
</head>
<body>
     
    <div id="space" class="selectDisable">
        <div class="infos">
            <div >
                Score: <span id="score">0</span>
            </div>
            <div>
                Health: <span id="health"  >100%</span> 
            </div>
            <div >
                Level: <span id="level">1/5</span> 
            </div>
            <div >
                Bullets:  <span id="bullets">1000</span>
            </div>
        </div>
        <img src="img/missile.png" id="plane1" me class="plane plane1" style="top:700px;left:300px" alt="">
        <div id="messages">Press Space key to start</div>
    </div>
     
    <script>   

        var space           = document.querySelector("#space");
        var plane           = document.querySelector("#plane1");
        var infosLevel      = document.querySelector("#level");
        var infosbullets    = document.querySelector("#bullets");
        var infosHealth     = document.querySelector("#health");
        var infosScore      = document.querySelector("#score");
        var messages        = document.querySelector("#messages");
        
        var shutsound1      = new Audio("sounds/shut1.wav");
        var shutsound2      = new Audio("sounds/shut2.wav");
        var explosionsound  = new Audio("sounds/explosion.mp3");

        plane.style.top      = "430px";
        plane.style.width    = "100px";
        plane.style.left     = "350px";
        plane.style.height   = "100px";

        var stop        = true;
        var level       = 1;
        var score       = 0;
        var scorestep   = 20;
        
        

        var Missile = function(top,left,direction){
            if(parseInt(infosbullets.innerHTML)==0)
                return;
            var missile = document.createElement("img");
            missile.setAttribute("src","img/missile2.png");
            missile.setAttribute("class","missile missile2");
            missile.setAttribute("direction",direction);
            missile.setAttribute("style","top:"+top+";left:"+left+"px;width:20px;height:20px");
            space.appendChild(missile);
            missile.style.left = left;
            missile.style.top = top;
            if(direction=="down")
                missile.style.transform = "rotate(180deg)";
            playSound(shutsound1);
            infosbullets.innerHTML = parseInt(infosbullets.innerHTML)-1;
        }

         

        space.addEventListener("mousemove",function(e){
            if(stop)
                return;
            var left = parseInt(plane.style.left);
            plane.style.left = (e.clientX-space.getBoundingClientRect().x)+"px";
        });

        space.addEventListener("mousedown",function(e){
            if(stop)
                return;
            if(e.button==0){
                var top = (parseInt(plane.style.top))+"px";
                var left = (parseInt(plane.style.left)+50)+"px";
                new Missile(top,left,"up"); 
            }
        });

        

        var playing = setInterval(function(){

            if(stop)
                return;

            if(score==100 && level==5){
                finish();
                return;
            }

            if(score==100 && level<5){
                
                level++;
                score = 0;
                infosLevel.innerHTML = level+"/5";
                infosScore.innerHTML = score;
                messages.style.display="block";
                messages.innerHTML = "Level "+level;
                stop = true;
                clear();
                setTimeout(function(){
                    messages.style.display="none";
                    messages.innerHTML = "";
                    stop = false;
                },3000);
                
            }
                
            if(!document.querySelector(".plane2")){
                for(var i=0;i<level;i++){
                    addPlane();
                }
            }
                
            missiles = document.querySelectorAll(".missile");
            planes   = document.querySelectorAll(".plane");

            for(var i=0;i<missiles.length;i++){
                var top = parseInt(missiles[i].style.top);
                var elem = missiles[i];
                if(top<0 || top>800){
                    elem.parentNode.removeChild(elem);
                }else{
                    if(elem.getAttribute("direction")=="up")
                        elem.style.top = (top-15) +"px";
                    else
                        elem.style.top = (top+15) +"px";
                }

                for(var j=0;j<planes.length;j++){
                    var planei = planes[j];
                    if(intersect(elem,planei)){
                        playSound(explosionsound);
                        elem.parentNode.removeChild(elem);
                        
                        if(plane === planei){
                            var health = parseInt(infosHealth.innerHTML);
                            health-=10;
                            infosHealth.innerHTML = health+"%";
                            if(health>=50){
                                infosHealth.style.color = "white";
                            }else{
                                infosHealth.style.color = "red";
                            }
                            if(health==0){
                                lost();
                                planei.setAttribute("src","img/explosion.gif");
                            }
                        }else{
                            score += scorestep;
                            infosScore.innerHTML = score *level;
                            planei.setAttribute("src","img/explosion.gif");
                            setTimeout(function(){
                                planei.parentNode.removeChild(planei);
                            },1000);
                        }
                    }
                }
            }
        },30);

        function clear(){
            for(var i=0;i<planes.length;i++){
                if(planes[i]==plane1)
                    continue;
                if(planes[i])
                    planes[i].parentNode.removeChild(planes[i]);
            }

             
        }

        function addPlane(){
            var plane2           = document.createElement("img");
            plane2.setAttribute("src","img/missile.png");
            plane2.setAttribute("class","plane plane2 selectDisable");
            space.appendChild(plane2);
            plane2.style.left    = (Math.random()*700)+"px";
            plane2.style.width   = "100px";
            plane2.style.height  = "100px";
            plane2.style.top     = "10px";
            var left = plane2.style.left;
            setInterval(function(){
                if(stop)
                    return;

                if(parseInt(plane.style.left) == parseInt(plane2.style.left)){
                    setTimeout(function(){
                        var top = (parseInt(plane2.style.top)+100)+"px";
                        var left = (parseInt(plane2.style.left)+50)+"px";
                        new Missile(top,left,"down"); 
                    },500);
                }

                if(parseInt(plane.style.left)>parseInt(plane2.style.left)){
                    plane2.style.left = (parseInt(plane2.style.left)+5)+"px";
                }else{
                    plane2.style.left = (parseInt(plane2.style.left)-5)+"px";
                }

            },100);
            return plane2;
        }

        

        function intersect(elem1,elem2){
            var x1    = parseInt(elem1.style.top)+parseInt(elem1.style.height)/2;
            var x2    = parseInt(elem2.style.top)+parseInt(elem2.style.height)/2;
            var y1    = parseInt(elem1.style.left)+parseInt(elem1.style.width)/2;
            var y2    = parseInt(elem2.style.left)+parseInt(elem2.style.width)/2;
            var dist1   = Math.abs(x1-x2);
            var dist2   = Math.abs(y1-y2);
            var marge   = 50;

            if((dist1>=0 && dist1<=marge) && (dist2>=0 && dist2<=marge))
                return true;
            else
                return false;
        }

        function start(){
            stop = false;
            messages.style.display = "none";
        }

        function pause(){
            stop = true;
            messages.style.display = "block";
            messages.innerHTML="Press Space key to start";
        }

        function lost(){
            pause();
            messages.innerHTML="You lost! <br/> Your score is "+infosScore.innerHTML;
            reset();
        }

        function reset(){
            infosbullets.innerHTML = "1000";
            infosHealth.innerHTML = "100%";
            infosScore.innerHTML = "0";
            plane1.setAttribute("src","img/missile.png");
            infosHealth.style.color = "white";
        }

        function finish(){
            pause();
            messages.innerHTML="Congratulations ! You win  <br/> Your score is "+infosScore.innerHTML;
            reset();
        }

         
        space.addEventListener("contextmenu",function(e){
            e.preventDefault();
        });
        
        document.addEventListener("keydown",function(e){
            
            if(e.keyCode == 32){
                if(stop){
                    start()
                }else{
                    pause()
                }
            }
        });

        function playSound(sound){
            if(!sound.paused){
                sound.pause();
                sound.currentTime = 0;
            }
            sound.play();
        }
        
    </script>
</body>
</html>

